<!DOCTYPE html>
<html>

<head>

    <title></title>
    <meta charset="utf-8" />
    <title>רישום עמותה</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--בשביל פונגאפ יש להוריד את השורה שמתחת מהערה-->
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; font-src data: *; script-src 'self' 'unsafe-inline' 'unsafe-eval' *; style-src 'self' 'unsafe-inline' *; img-src * data: 'unsafe-inline'">

    <script src="./cordova.js"></script>

    <!--מאסטר-->
    <script src="js/master.js"></script>

    <link href="css/fa-fa-icons.min.css" rel="stylesheet" />
    <link href="css/w3.css" rel="stylesheet" />
    <link href="css/jqmCss.css" rel="stylesheet" />
    <link href="css/StyleSheet.css" rel="stylesheet" />

    <script src="js/jquery.js"></script>
    <script src="js/jqm.js"></script>


    <script>
        const assoc = GENERAL.assocWebServerAddress;
    </script>

    <script>
        $(document).ready(function () {
            console.log("in");
        })
        function RegisterAssoc() {

            var Code = ($("#AssocNum").val() != "") ? $("#AssocNum").val() : null;
            var Name = $("#AssocName").val() != "" ? $("#AssocName").val() : null;
            var Desc = $("#AssocDesc").val() != "" ? $("#AssocDesc").val() : null;
            var Account = $("#AssocAccount").val() != "" ? $("#AssocAccount").val() : null;
            var Web = $("#AssocWebsite").val() != "" ? $("#AssocWebsite").val() : null;
            var Year = $("#AssocYear").val() != "" ? $("#AssocYear").val() : null;

            $.ajax({
                dataType: "json",
                url: "http://proj.ruppin.ac.il/bgroup51/test1/bekeilu/ValidateAmuta/WebService.asmx" + "/ValidateAmuta",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({ code: Code }),
                success: function (data) {

                    var amuta = data.d;

                    if (amuta == true) {

                        $.ajax({
                            dataType: "json",
                            url: assoc + "AddNewAssoc",
                            contentType: "application/json; charset=utf-8",
                            type: "POST",
                            data: JSON.stringify({ code: Code, name: Name, desc: Desc, account: Account, web: Web, year: Year }),
                            success: function (data) {

                                var amu = JSON.parse(data.d);

                                if (amu == "True") {
                                    alert("העמותה נרשמה בהצלחה");
                                }
                            },
                            error: function (err) { }
                        });// Ajax AddNewAssoc
                    }
                    else {
                        $.ajax({
                            dataType: "json",
                            url: assoc + "AddNewTempAssoc",
                            contentType: "application/json; charset=utf-8",
                            type: "POST",
                            data: JSON.stringify({ code: Code, name: Name, desc: Desc, account: Account, web: Web, year: Year }),
                            success: function (data) {
                                alert("העמותה הועברה לאישור מנהלי המערכת. ניצור עמכם קשר תוך 2 ימי עסקים להשלמת תהליך הרישום");
                            },
                            error: function (err) { }
                        });// Ajax AddNewTempAssoc
                    }
                },
                error: function (err) { }
            });// Ajax ValidateAssoc


            //$.ajax({
            //    dataType: "json",
            //    url: assoc + "AddNewAssoc",
            //    contentType: "application/json; charset=utf-8",
            //    type: "POST",
            //    data: JSON.stringify({ code: Code, name: Name, desc: Desc, account: Account, web: Web, year: Year }),
            //    success: function (data) {

            //        var amuta = JSON.parse(data.d);

            //        if (amuta == "True") {
            //            alert("העמותה נרשמה בהצלחה");
            //        }
            //        else {
            //            alert("המשתמש כבר קיים במערכת, אנא התחברו מחדש");
            //        }
            //        location.href = "Login-Taramti.html#LoginPage";
            //    },
            //    error: function (err) { }
            //});

        }
    </script>

</head>

<body>

    <!--דף זה מכיל הוספת עמותה -->

    <div data-role="page" id="RegisterAssocPage">
        <div id="UpperLogo">
            <img id="TaramtiLogo" src="img/Taramti-LOGO.JPG" />
            <div id="TaramtiMenuIconDiv">
                <i id="TaramtiMenuIcon" class="fa fa-ellipsis-v fa-4x"></i>
            </div>
        </div>

        <!-- להוריד פלייס הולדרים מיותרים -->
        <div class="Form" id="RegisterAssocForm">
            <h2> רישום עמותה חדשה </h2>
            <h4><b>מספר עמותה</b></h4>
            <input type="text" placeholder="מספר עמותה" id="AssocNum" required>
            <!--כאן תהיה ולידציה של מספר חברה - בעצם עם הווב סרוויס-->
            <h4><b>שם עמותה</b></h4>
            <input type="text" placeholder="הזן שם עמותה" id="AssocName" required>
            <h4>תיאור עמותה</h4>
            <textarea class="form-control" id="AssocDesc" rows="15"></textarea>
            <h4>חשבון עמותה</h4>
            <input type="email" placeholder="אימייל פייפל" id="AssocAccount" name="account">
            <h4>אתר העמותה</h4>
            <input class="form-control" placeholder="www.amuta.com" id="AssocWebsite" name="web">
            <h4>שנת היווסדות</h4>
            <input class="form-control" id="AssocYear" placeholder="1980">

            <p>בלחיצה על 'רשום עמותה' אתה מסכים לתנאים הבאים <a href="#">תנאים מחייבים</a>.</p>

            <a href="#ImSureDialog" id="RegisterAssocbtn" class="ui-shadow ui-btn ui-corner-all ui-btn-block" data-transition="flip">רשום עמותה</a>

            <h5><a href="Login-Taramti.html"> חזור</a></h5>

            <!------------------------->
            <!------------------------->
            <a onclick="location.href = 'Login-Taramti.html'">Login-Taramti.html</a>
            <!------------------------->
            <!------------------------->

        </div>
    </div>

    <div data-role="page" data-dialog="true" data-close-btn="none" id="ImSureDialog">
        <div data-role="header">
            <h2>תרמתי בבית</h2>
        </div>
        <div class="ui-content" role="main">
            <h4>פרטי העמותה שהזנת נשלחים אל רשם העמותות לבדיקה, האם את/ה בטוח/ה שהפרטים שהזנת נכונים?</h4>
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#RegisterAssocPage" id="cancel-button" class="ui-btn ui-btn-b ui-shadow ui-corner-all">לא</a>
                </div>
                <div class="ui-block-b">
                    <a href="#RegisterAssocPage" onclick="RegisterAssoc()" id="exit-button" class="ui-btn ui-shadow ui-corner-all">כן</a>
                </div>
            </div>
        </div>
    </div>
</body>

</html>