<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--בשביל פונגאפ יש להוריד את השורה שמתחת מהערה-->
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; font-src data: *; script-src 'self' 'unsafe-inline' 'unsafe-eval' *; style-src 'self' 'unsafe-inline' *; img-src * data: 'unsafe-inline'">

    <script src="cordova.js"></script>

    <!--מאסטר-->
    <script src="js/master.js"></script>

    <script src="js/jquery.js"></script>

    <link href="css/fa-fa-icons.min.css" rel="stylesheet" />
    <link href="css/w3.css" rel="stylesheet" />
    <link href="css/jqmCss.css" rel="stylesheet" />
    <link href="css/StyleSheet.css" rel="stylesheet" />

    <!--<link href="lib/jquery.mobile-1.4.5.min.css" rel="stylesheet" />-->
    <!--<link href="lib/jqueryUI/jqueryUI.css" rel="stylesheet" />-->

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="js/jqm.js"></script>

    <!--<script src="lib/jquery.mobile-1.4.5.min.js"></script>-->
    <!--<script src="lib/jqueryUI/jqueryUI.js"></script>-->

    <script>
        const generic = GENERAL.genericWebServerAddress;
        const aucwebservice = GENERAL.auctionWebServerAddress;
        const assoc = GENERAL.assocWebServerAddress;
    </script>


    <script>

        $(document).ready(function () {
            // אג'קס למילוי כל הקטגוריות
            $.ajax({
                dataType: "json",
                url: aucwebservice + "GetAllProductsCategories",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({}),
                success: function (data) {

                    var categories = JSON.parse(data.d);

                    if (categories[0] != null) {
                        for (var i = 0; i < categories.length; i++) {
                            var opt = '';
                            opt += '<option value="' + categories[i].Cat_id + '">' + categories[i].Cat_Name + '</option>';
                            $("#AuctionCategories").append(opt);
                        }
                    }
                },
                error: function (err) { }
            });

            // אג'קס למילוי כל העמותות
            $.ajax({
                dataType: "json",
                url: assoc + "GetAllAmotaDetails",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({}),
                success: function (data) {

                    var Associations = JSON.parse(data.d);

                    if (Associations[0] != null) {
                        for (var i = 0; i < Associations.length; i++) {
                            var opt = '';
                            opt += '<option value="' + Associations[i].Association_Code + '">' + Associations[i].Association_Name + '</option>';
                            $("#AuctionAssoc").append(opt);
                        }
                    }
                },
                error: function (err) { }
            });
        });




        $(document).on("pagecreate", "#AddingAuctionPage", function () {

            $("#tabs").tabs("option", "active", 1);
            $('#DefualtTab').addClass('ui-btn-active');
            LocalPicArr = new Array();
            ServerPicArr = new Array();
            Local_i = 0;
            Server_i = 0;
        });


        function OpenCameraORChooseFile(Flag) {
            var x = Camera.PictureSourceType.PHOTOLIBRARY;
            if (Flag) {
                x = Camera.PictureSourceType.CAMERA;
            }
            navigator.camera.getPicture(onCameraSuccess, onCameraFail, {
                quality: 100,
                destinationType: Camera.DestinationType.FILE_URI,//FILE_URI
                targetHeight: 640,
                targetWidth: 640,
                sourceType: x

            });
        }



        //function AddingProductAuction() {
        //    $.ajax({
        //        dataType: "json",
        //        url: aucwebservice + "AddingProductAuction",
        //        contentType: "application/json; charset=utf-8",
        //        type: "POST",
        //        data: JSON.stringify({ Arr: picArr }),
        //        success: function (data) {

        //            var productCode = JSON.parse(data.d)

        //            if (productCode != "") {

        //                for (var pic in LocalPicArr) {
        //                    uploadPhoto(imageURI, productCode)
        //                }
        //                $.ajax({
        //                    dataType: "json",
        //                    url: aucwebservice + "AddingProductPictures",
        //                    contentType: "application/json; charset=utf-8",
        //                    type: "POST",
        //                    data: JSON.stringify({ Arr: ServerPicArr, itemId: productCode}),
        //                    success: function (data) {
        //                        var isSaved = JSON.parse(data.d)
        //                        if (isSaved) {
        //                            alert("המכרז נשמר בהצלחה");
        //                        }
        //                        else {
        //                            alert("יתכן וקרתה בעיה במהלך שמירת תמונות המכרז, הבעיה הועברה למנהלי המערכת ");
        //                        }
        //                    },
        //                    error: function (err) { }
        //                });
        //            }
        //            else {
        //                alert("יתכן וקרתה בעיה במהלך שמירת המכרז, הבעיה הועברה למנהלי המערכת ");
        //            }
        //        },
        //        error: function (err) { }
        //    });

        //}


        function AddingProductAuction() {

            alert("נכנס");

            var productCode = 14;

            alert("הגדיר");
            
            for (var picNum in LocalPicArr) {
                alert(picNum);
                alert(productCode);
                var thisImageURI = LocalPicArr[picNum]
                alert(thisImageURI);
                uploadPhoto(thisImageURI, picNum, productCode)
                alert("תמונה אחת הועלתה");
            }

            alert("העלה לסרבר");

            //$.ajax({
            //    dataType: "json",
            //    url: aucwebservice + "AddingProductPictures",
            //    contentType: "application/json; charset=utf-8",
            //    type: "POST",
            //    data: JSON.stringify({ Arr: ServerPicArr, itemId: productCode }),
            //    success: function (data) {
            //        var isSaved = JSON.parse(data.d)
            //        if (isSaved) {
            //            alert("המכרז נשמר בהצלחה");
            //        }
            //        else {
            //            alert("יתכן וקרתה בעיה במהלך שמירת תמונות המכרז, הבעיה הועברה למנהלי המערכת ");
            //        }
            //    },
            //    error: function (err) { }
            //});
        }



        function onCameraSuccess(imageURI) {
            var $img = $("<img>").attr("src", imageURI);
            $("#image_holder").append($img);
            LocalPicArr.push(imageURI);
            Local_i++;
            //uploadPhoto(imageURI);
        }



        function uploadPhoto(thisImageURI, picNum, productCode) {
            //   Load(); // Start the spinning "working" animation
            var options = new FileUploadOptions(); // PhoneGap object to allow server upload
            options.fileKey = "file";
            options.fileName = productCode + "_pic_" + picNum; // file name
            options.mimeType = "image/jpeg"; // file type

            alert(productCode);

            var ft = new FileTransfer();
            ft.upload(thisImageURI, encodeURI("http://proj.ruppin.ac.il/bgroup51/prod/ReturnValue.ashx"), win, fail, options); // Upload
        } // Upload Photo

        function win(r) {
            var path = r.response;
            //$img.attr("src", "http://proj.ruppin.ac.il/bgroup51/prod/Uploads/Items/" + options.fileName + ".jpg");
            ServerPicArr.push("http://proj.ruppin.ac.il/bgroup51/prod/Uploads/Items/" + options.fileName + ".jpg");
            alret(ServerPicArr[Server_i])
            Server_i++;
            // UnLoad(); // Stop "working" animation
        } // win (upload success)

        function fail(error) {
            alert("An error has occurred: Code = " + error.code);
        }

        function onCameraFail(message) {
            alert('Failed because: ' + message);
        }

    </script>

</head>
<body>

    <!--דף זה מכיל דף הוספת מכרז-->

    <div data-role="page" id="AddingAuctionPage">
        <div id="UpperLogo">
            <img id="TaramtiLogo" src="img/Taramti-LOGO.JPG" />
            <div id="TaramtiMenuIconDiv">
                <i id="TaramtiMenuIcon" class="fa fa-ellipsis-v fa-4x"></i>
            </div>
        </div>

        <div data-role="tabs" id="tabs">
            <div data-role="navbar">
                <ul>
                    <li><a href="#AddingMoneyAuctionTab" data-ajax="false">צור מכרז תרומה</a></li>
                    <li><a id="DefualtTab" href="#AddingProductAuctionTab" data-ajax="false">צור מכרז מוצר</a></li>
                </ul>
            </div>

            <div id="AddingProductAuctionTab" class="ui-body-d ui-content">
                <div class="Form" id="AddingProductAuctionForm">
                    <h2> יצירת מכרז מוצר</h2>
                    <h4>שם המוצר</h4>
                    <input type="text" id="ProdNum">
                    <h4>תיאור המוצר</h4>
                    <textarea class="form-control" id="ProdDesc" rows="10"></textarea>

                    <h4>מיקום</h4>
                    <input type="text" id="ProdLocation" required>
                    <!-- שימוש בג'יפיאס -->

                    <h4>בחר קטגוריה</h4>
                    <select id="AuctionCategories">
                        <!--<option value="value">שליפה מאג'אקס</option>-->
                    </select>

                    <h4>משך המכרז (בימים)</h4>
                    <select id="AuctionLast">
                        <option value="value">1</option>
                        <option value="value">2</option>
                        <option value="value">3</option>
                        <option value="value">4</option>
                        <option value="value">5</option>
                        <option value="value">6</option>
                        <option value="value">7</option>
                    </select>
                    <h4>בחר עמותה</h4>
                    <select id="AuctionAssoc">
                        <!--<option value=" value">
                        שליפה מאג'אקס</option>-->
                    </select>
                    <h4>מחיר מינימום שארצה לקבל על המוצר</h4>
                    <input type="text" id="AuctionMinPrice" />
                    <h4>תמונות המוצר</h4>
                    <!--מצלמה-->
                    <div>
                        <a class="ui-shadow ui-btn ui-corner-all ui-btn-block" id="CameraBtn" onclick="OpenCameraORChooseFile(true);"><i class="fa fa-camera w3-large w3-text-black"></i> </a>
                        <div style="height:0px; overflow:hidden">
                            <input type="file" id="fileInput" name="fileInput" />
                        </div>
                        <button id="UploadFileBtn" type="button" onclick="OpenCameraORChooseFile(false);">בחר תמונה מגלריה</button>
                    </div>
                    <!------------------------->
                    <!-------------להוסיף איקסים על התמונות לצורך מחיקה------------>
                    <div id="image_holder">
                        <img src="img/Desert.jpg" />
                        <img src="img/Koala.jpg" />
                        <img src="img/Tulips.jpg" />
                    </div>

                    <!--<input type="button" id="Adonbtn" value="cshev" onclick="savePic8()" />-->

                    <input type="button" id="AddingProductAuctionbtn" value="שגר מכרז" onclick="AddingProductAuction()" />
                    <h5><a onclick="location.href = 'Login-Taramti.html'">חזור</a></h5>

                    <!------------------------->
                    <!------------------------->
                    <a onclick="location.href = 'Login-Taramti.html'">Login-Taramti.html</a>
                    <!------------------------->
                    <!------------------------->
                </div>
            </div>

            <div id="AddingMoneyAuctionTab">
                <h1>דף יצירת מכרז תרומה</h1>
            </div>
        </div>
        <!-- להוריד פלייס הולדרים מיותרים -->

    </div>


</body>
</html>
