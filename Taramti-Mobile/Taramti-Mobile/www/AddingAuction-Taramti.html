<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>הוספת מכרז</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; font-src data: *; script-src 'self' 'unsafe-inline' 'unsafe-eval' *; style-src 'self' 'unsafe-inline' *; img-src * data: 'unsafe-inline'">
    <!--<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Fidele Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
    Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="./cordova.js"></script>

    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/fa-fa-icons.min.css" rel="stylesheet" />
    <link href="css/w3.css" rel="stylesheet" />
    <link href="css/jqmCss.css" rel="stylesheet" />
    <link href="css/StyleSheet.css" rel="stylesheet" />




    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>



    <!--<script src="js/jquery.js"></script>
    <script src="js/jquery.min.js"></script>-->
    <script src="js/jqm.js"></script>

    <script src="js/master.js"></script>

    <link href="dist/css/select2.min.css" rel="stylesheet" />
    <script src="dist/js/select2.min.js"></script>
    <!--font-Awesome-->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!--//font-Awesome-->
    <script>
        const generic = GENERAL.genericWebServerAddress;
        const aucwebservice = GENERAL.auctionWebServerAddress;
        const assoc = GENERAL.assocWebServerAddress;
        const user = GENERAL.USER;
    </script>



    <!--<script type="text/javascript">
    $(document).ready(function() {
        $(".js-example-basic-single").select2();
    });
        </script>-->

    <script>
        var LocalPicArr = new Array(); //שמירת הנתיב של התמונות במכשיר
        var Local_i = 0;
        var ServerPicArr = new Array();//שמירת הנתיב של התמונות בשרת
        var Server_i = 0;
        var CancelMessage = "";

        $(document).ready(function () {
            // אג'קס למילוי כל הקטגוריות

            $.ajax({
                dataType: "json",
                url: aucwebservice + "GetAllProductsCategories",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({}),
                success: function (data) {

                    var categories = JSON.parse(data.d);

                    if (categories[0] != null) {
                        for (var i = 0; i < categories.length; i++) {
                            var opt = '';
                            opt += '<option value="' + categories[i].Cat_id + '">' + categories[i].Cat_Name + '</option>';
                            $("#AuctionCategories").append(opt);
                        }
                    }
                },
                error: function (err) { }
            });

            // אג'קס למילוי כל העמותות
            $.ajax({
                dataType: "json",
                url: assoc + "GetAllAmotaDetails",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({}),
                success: function (data) {

                    var Associations = JSON.parse(data.d);

                    if (Associations[0] != null) {
                        for (var i = 0; i < Associations.length; i++) {
                            var opt = '';
                            opt += '<option value="' + Associations[i].Association_Code + '">' + Associations[i].Association_Name + '</option>';
                            $("#AuctionAssoc").append(opt);
                        }
                    }
                },
                error: function (err) { }
            });

            // אג'קס למילוי כל הערים

            $.ajax({
                dataType: "json",
                url: generic + "GetAllCities",
                contentType: "application/json; charset=utf-8",
                type: "POST",
                data: JSON.stringify({}),
                success: function (data) {

                    var Cities = JSON.parse(data.d);

                    if (Cities[0] != null) {
                        for (var i = 0; i < Cities.length; i++) {
                            var opt = '';
                            opt += '<option value="' + Cities[i].CityCode + '">' + Cities[i].CityName + '</option>';
                            $("#ProdLocation1").append(opt);
                        }
                    }
                },
                error: function (err) { }
            });

            $(".js-example-basic-single").select2();
            $("#ProdLocation1").select2();

            //$("select2-selection select2-selection--single").css("display", "none");
           // $(".select2-container--default .select2-selection--single :not('.select')").css("display", "none");
        });

        $(document).on("pagecreate", "#AddingAuctionPage", function () {

            $("#tabs").tabs("option", "active", 1);
            $('#DefualtTab').addClass('ui-btn-active');
        });

        $(document).ready(function () {
            var _originalSize = $(window).width() + $(window).height()
            $(window).resize(function () {
                if ($(window).width() + $(window).height() != _originalSize) {
                    $("#fixedCircle").css("display", "none");
                    $("#fixedHome").css("display", "none");
                }
                else {
                    $("#fixedCircle").css("display", "block");
                    $("#fixedHome").css("display", "block");
                }
            });
        });

        function OpenCameraORChooseFile(Flag) {
            var x = Camera.PictureSourceType.PHOTOLIBRARY;
            CancelMessage = "שים לב-אף תמונה לא נבחרה "
            if (Flag) {
                x = Camera.PictureSourceType.CAMERA;
                CancelMessage = "שים לב- לא צולמה אף תמונה"
            }
            navigator.camera.getPicture(onCameraSuccess, onCameraFail, {
                quality: 100,
                destinationType: Camera.DestinationType.FILE_URI,//FILE_URI
                targetHeight: 640,
                targetWidth: 640,
                sourceType: x
            });
        }

        function onCameraSuccess(imageURI) {
            var $imgDiv = $("<div>");
            var $imgA = $("<a>").addClass("closeBox").attr("id", Local_i);
            var $img = $("<img>").attr("src", imageURI);
            $imgDiv.append($imgA).append($img);
            $("#image_holder").append($imgDiv);


            $imgA.on("tap", function () {
                $(this).parent().remove();
                ////מציאת האינדקס של הנתיב במערך ומחיקתו
                var imgIndex = $(this).attr("id");
                LocalPicArr.splice(imgIndex, 1);
            });

            LocalPicArr.push(imageURI);
            Local_i++;
        }

        function addToServerPicArr(stringServerPath) {
            ServerPicArr.push(stringServerPath);
            Server_i++;
        }

        function AddingProductAuction() {
            if (!Local_i == 0) {
                var itemName = $("#ProdNum").val();
                var itemDesc = $("#ProdDesc").val();
                var city = $("#ProdLocation1").val();
                var cat = $("#AuctionCategories").val();
                var days = $("#AuctionLast").val();
                var assoc = $("#AuctionAssoc").val();
                var price = $("#AuctionMinPrice").val();
                var user1 = user.userID();
                //var user1 = "300948552";

                if (city != -1 && cat != -1 && days != -1 && assoc != -1) {
                    $.ajax({
                        dataType: "json",
                        url: aucwebservice + "AddingProductAuction",
                        contentType: "application/json; charset=utf-8",
                        type: "POST",
                        data: JSON.stringify({ itemName: itemName, itemDesc: itemDesc, city: city, cat: cat, days: days, assoc: assoc, price: price, user: user1 }),
                        success: function (data) {
                            var productCode = JSON.parse(data.d)
                            if (productCode != "") {
                                for (var picNum in LocalPicArr) {
                                    var thisImageURI = LocalPicArr[picNum]
                                    uploadPhoto(thisImageURI, picNum, productCode)
                                    addToServerPicArr(stringServerPath);
                                }
                                $.ajax({
                                    dataType: "json",
                                    url: aucwebservice + "AddingProductPictures",
                                    contentType: "application/json; charset=utf-8",
                                    type: "POST",
                                    data: JSON.stringify({ Arr: ServerPicArr, itemId: productCode }),
                                    success: function (data) {
                                        var isSaved = JSON.parse(data.d)
                                        if (isSaved) {
                                            alert("המכרז נשמר בהצלחה");
                                            location.href = 'app.html';
                                        }
                                        else {
                                            alert("יתכן וקרתה בעיה במהלך שמירת תמונות המכרז, הבעיה הועברה למנהלי המערכת ");
                                        }
                                    },
                                    error: function (err) { }
                                });
                            }
                            else {
                                alert("יתכן וקרתה בעיה במהלך שמירת המכרז, הבעיה הועברה למנהלי המערכת ");
                            }
                        },
                        error: function (err) { }
                    });
                }
                else {
                    alert("אנא מלא את השדות המבוקשים");
                }
            }
            else {
                alert("לא ניתן להוסיף מכרז ללא תמונות- יש להוסיף לפחות תמונה אחת")
            }
        }

        function uploadPhoto(thisImageURI, picNum, productCode) {
            var options = new FileUploadOptions(); // PhoneGap object to allow server upload
            options.fileKey = "file";
            options.fileName = productCode + "_pic_" + picNum; // file name
            options.mimeType = "image/jpeg"; // file type
            var ft = new FileTransfer();
            ft.upload(thisImageURI, encodeURI("http://proj.ruppin.ac.il/bgroup51/prod/ReturnValue.ashx"), win, fail, options); // Upload
            stringServerPath = String("http://proj.ruppin.ac.il/bgroup51/prod/Uploads/Items/" + options.fileName + ".jpg");
        } // Upload Photo

        function win(r) {
            var path = r.response;
        } // win (upload success)

        function fail(error) {
            alert("An error has occurred: Code = " + error.code);
            alert(error.body);
        }

        function onCameraFail(message) {
            alert(CancelMessage);
            //alert('Failed because: ' + message);
        }

        //window.onload = function () {
        //    var $options = $('#ProdLocation option');
        //    document.getElementById("SearchBox").onkeyup = function () {
        //        var $HiddenOptions = $('#CustomerSelectHidden option');
        //        $HiddenOptions.each(function (index, value) {
        //            document.getElementById('ProdLocation').appendChild(this);
        //        });
        //        var search = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
        //        var element = $options.filter(function () {
        //            var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
        //            return !~text.indexOf(search);

        //        }).appendTo(document.getElementById('CustomerSelectHidden'));
        //        $('#ProdLocation option').sort(Sort).appendTo('#ProdLocation');
        //    }
        //}
        //function Sort(a, b) {
        //    return (a.innerHTML > b.innerHTML) ? 1 : -1;
        //}
    </script>


    <!--<script>
    function myFunction() {
        // Declare variables
        var input, filter, ul, li, a, i;
        input = document.getElementById("SearchBox");
        filter = input.value.toUpperCase();
        ul = document.getElementById("ProdLocation");
        a = ul.getElementsByTagName('option');

        // Loop through all list items, and hide those who don't match the search query
        for (i = 0; i < a.length; i++) {
            //a = li[i].getElementsByTagName("li")[0];
            if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
                //a[i].style.display = "";
                a[i].selected = true;
                //$('#ProdLocation').val(i);
                $('#ProdLocation').change();
            } else {
                a[i].style.display = "none";
            }
        }
    }
        </script>-->
</head>

<body>

    <!--דף זה מכיל דף הוספת מכרז-->

    <div class="pageBC" data-role="page" id="AddingAuctionPage">
        <!--<img id="BkgroundImg" src="images/LoginBackground.jpg" />-->
        <div id="MenuBarDiv" style="z-index:150" class="navigation-1 navigation-5">

            <img id="LogoBidIt" src="images/LogoBidIt.png" />
            <div class="nav-left">
                <img onclick="location.href = 'app.html'" style="z-index:150" id="TaramtiLogo" src="images/LogoCircle.png" />
            </div>
            <div class="nav-right">
                <span class="nav-list-it5">
                    <i class="fa fa-bars"></i>
                </span>
                <script>
                    $("span.nav-list-it5").click(function () {
                        $("ul.nav-top-list1").slideToggle("slow", function () {
                            // Animation complete.
                        });
                    });
                </script>
                <ul class="nav-top-list nav-top-list1">
                    <li><a onclick="location.href = 'app.html'">דף הבית</a><label>|</label></li>
                    <li><a onclick="location.href = 'AddingAuction-Taramti.html'">הוספת מכרז</a><label>|</label></li>
                    <li><a onclick="location.href = 'userDetails.html'">פרופיל משתמש</a><label>|</label></li>
                    <li><a onclick="location.href = 'appSettings.html#Settings'">הגדרות אפליקציה</a><label>|</label></li>
                    <li><a onclick="location.href = 'appSettings.html#SearchAssoc'">פרטי עמותות</a><label>|</label></li>
                    <li><a onclick="location.href='RegisterAssoc-Taramti.html'">הוספת עמותה</a></li>

                    <!--<li><a class="active" href="#"><i class="fa fa-home"></i>Home</a><label>|</label></li>-->
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>

        <div data-role="tabs" id="tabs">
            <div data-role="navbar">
                <ul>
                    <li><a href="#AddingMoneyAuctionTab" data-ajax="false">צור מכרז תרומה</a></li>
                    <li><a id="DefualtTab" href="#AddingProductAuctionTab" data-ajax="false">צור מכרז מוצר</a></li>
                </ul>
            </div>

            <div id="AddingProductAuctionTab" class="ui-body-d ui-content">
                <div class="Form" id="AddingProductAuctionForm">
                    <h2> יצירת מכרז מוצר</h2>
                    <h4>שם המוצר</h4>
                    <input type="text" id="ProdNum">
                    <h4>תיאור המוצר</h4>
                    <textarea class="form-control" id="ProdDesc" rows="10"></textarea>

                    <h4>מיקום</h4>

                    <select id="ProdLocation1" class="js-example-basic-single" style="widows:200px" ></select>
                    <!-- שימוש בג'יפיאס -->
                </div>
                <div style="display: none;">
                    <select id="CustomerSelectHidden"></select>
                </div>


                <h4>בחר קטגוריה</h4>
                <select id="AuctionCategories">
                    <option value="-1"> בחר</option>
                </select>

                <h4>משך המכרז (בימים)</h4>
                <select id="AuctionLast">
                    <option value="-1"> בחר</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                </select>
                <h4>בחר עמותה</h4>
                <select id="AuctionAssoc">
                    <option value="-1"> בחר</option>

                </select>
                <h4>מחיר מינימום שארצה לקבל על המוצר</h4>
                <input type="text" id="AuctionMinPrice" />
                <h4>תמונות המוצר</h4>
                <!--מצלמה-->
                <div>
                    <a class="ui-shadow ui-btn ui-corner-all ui-btn-block" id="CameraBtn" onclick="OpenCameraORChooseFile(true);"><i class="fa fa-camera w3-large w3-text-black"></i> </a>
                    <div style="height:0px; overflow:hidden">
                        <input type="file" id="fileInput" name="fileInput" />
                    </div>
                    <button id="UploadFileBtn" type="button" onclick="OpenCameraORChooseFile(false);">בחר תמונה מגלריה</button>
                </div>

                <div id="image_holder">
                </div>

                <div class="RoundDivfixed">
                    <div id="fixedCircle">

                        <div> <a onclick="location.href = 'app.html'"><img src="images/circle-for-home.png" /></a></div>
                    </div>
                    <div id="fixedHome">
                        <div> <a onclick="location.href = 'app.html'"><img src="images/Home1600.png" /></a></div>

                    </div>
                </div>
            </div>

            <div id="AddingMoneyAuctionTab">
                <h1>דף יצירת מכרז תרומה</h1>
            </div>
        </div>
        <!-- להוריד פלייס הולדרים מיותרים -->
    </div>
</body>

</html>